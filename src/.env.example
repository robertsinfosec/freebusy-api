# Freebusy API (Cloudflare Worker) — Local development configuration
# -----------------------------------------------------------------------------
# This file is SAFE to commit only as an example. Never commit real secrets.
# For local dev, copy to `src/.env` and fill in non-production values.
#
# Design goals:
# - Single source of truth for the calendar owner's timezone (IANA).
# - API emits canonical UTC instants (RFC 3339 / ISO 8601 with trailing "Z").
# - UI renders *owner-day* columns (based on CALENDAR_TIMEZONE), while optionally
#   displaying times in a viewer-selected timezone.
# - All-day events are treated as "busy for the entire owner-day" (no leaking
#   into adjacent owner-days in the grid).

# -----------------------------------------------------------------------------
# Upstream calendar feed
# -----------------------------------------------------------------------------

# HTTPS iCal free/busy feed to proxy (must be reachable from Cloudflare Workers).
# Example: a private calendar free/busy URL. Use a non-production URL for local dev.
FREEBUSY_ICAL_URL=https://example.com/calendar/freebusy.ics

# -----------------------------------------------------------------------------
# Calendar semantics (owner configuration)
# -----------------------------------------------------------------------------

# Calendar owner's timezone (IANA).
# Examples: America/New_York, America/Chicago, America/Denver, America/Los_Angeles
CALENDAR_TIMEZONE=America/New_York

# Window size in weeks (integer > 0).
# The API window is computed as:
#   start = 00:00:00.000 (owner local) on "today"
#   end   = 00:00:00.000 (owner local) on the day after the final day (exclusive)
# The response also includes inclusive endDate for convenience.
WINDOW_WEEKS=4

# ISO week start day for UI grid alignment (1=Monday ... 7=Sunday).
# If your UI does not care, leave at 1 (Monday).
WEEK_START_DAY=1

# -----------------------------------------------------------------------------
# Working hours (owner local times)
# -----------------------------------------------------------------------------
# A JSON string describing the owner's working availability in *owner local time*.
# Times are "HH:MM" 24-hour. Day-of-week uses ISO numbering (1=Mon ... 7=Sun).
#
# Example: 4x10 schedule Tue–Fri 08:00–18:00 in Mountain time:
#   CALENDAR_TIMEZONE=America/Denver
#   WORKING_HOURS_JSON={"weekly":[{"dayOfWeek":2,"start":"08:00","end":"18:00"},{"dayOfWeek":3,"start":"08:00","end":"18:00"},{"dayOfWeek":4,"start":"08:00","end":"18:00"},{"dayOfWeek":5,"start":"08:00","end":"18:00"}]}
#
WORKING_HOURS_JSON={"weekly":[{"dayOfWeek":1,"start":"09:00","end":"17:00"},{"dayOfWeek":2,"start":"09:00","end":"17:00"},{"dayOfWeek":3,"start":"09:00","end":"17:00"},{"dayOfWeek":4,"start":"09:00","end":"17:00"},{"dayOfWeek":5,"start":"09:00","end":"17:00"}]}

# -----------------------------------------------------------------------------
# CORS (Cross-Origin Resource Sharing)
# -----------------------------------------------------------------------------

# Comma-separated list of allowed origins (required; no defaults in code).
# Example: https://freebusy.robertsinfosec.com,http://localhost:5173
CORS_ALLOWLIST=http://localhost:5173

# -----------------------------------------------------------------------------
# Rate limiting (Durable Object)
# -----------------------------------------------------------------------------

# Random salt used to hash IPs for rate limiting. Generate with:
#   openssl rand -hex 32
RL_SALT=replace-with-random-string

# Per-IP rate limit window (milliseconds) and max requests per window. Integers > 0 (required).
RATE_LIMIT_WINDOW_MS=300000
RATE_LIMIT_MAX=60

# Optional global rate limit (all requests combined). Leave both blank to disable.
RATE_LIMIT_GLOBAL_WINDOW_MS=
RATE_LIMIT_GLOBAL_MAX=

# -----------------------------------------------------------------------------
# Feature flags and safety limits
# -----------------------------------------------------------------------------

# Feature flag to enable/disable /freebusy. Accepts true/false/1/0/off.
FREEBUSY_ENABLED=true

# In-memory cache TTL for upstream parsing (seconds). Keep small; default recommended 60.
CACHE_TTL_SECONDS=60

# Maximum upstream payload size (bytes). Prevents resource exhaustion.
# 1.5 MB = 1572864
UPSTREAM_MAX_BYTES=1572864
