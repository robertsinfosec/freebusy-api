{
  "version": 3,
  "sources": ["../bundle-VGrhv0/strip-cf-connecting-ip-header.js", "../../../src/ical.ts", "../../../src/freebusy.ts", "../../../src/env.ts", "../../../src/rateLimit.ts", "../../../src/index.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-VGrhv0/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-VGrhv0/middleware-loader.entry.ts"],
  "sourceRoot": "/home/robert/gitlocal/robertsinfosec/freebusy-api/src/.wrangler/tmp/dev-C4artY",
  "sourcesContent": ["function stripCfConnectingIPHeader(input, init) {\n\tconst request = new Request(input, init);\n\trequest.headers.delete(\"CF-Connecting-IP\");\n\treturn request;\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\treturn Reflect.apply(target, thisArg, [\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\n\t\t]);\n\t},\n});\n", "import { BusyBlock } from \"./freebusy\";\n\nconst DAY_MS = 24 * 60 * 60 * 1000;\n\nexport function unfoldLines(raw: string): string[] {\n  const lines = raw.split(/\\r?\\n/);\n  const unfolded: string[] = [];\n  for (const line of lines) {\n    if (line.startsWith(\" \") || line.startsWith(\"\\t\")) {\n      if (unfolded.length === 0) continue;\n      unfolded[unfolded.length - 1] += line.slice(1);\n    } else {\n      unfolded.push(line.trimEnd());\n    }\n  }\n  return unfolded;\n}\n\nfunction getOffsetMinutes(date: Date, timeZone: string): number {\n  const parts = new Intl.DateTimeFormat(\"en-US\", {\n    timeZone,\n    hour12: false,\n    year: \"numeric\",\n    month: \"2-digit\",\n    day: \"2-digit\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n  }).formatToParts(date);\n\n  const lookup = Object.fromEntries(\n    parts\n      .filter((p) => p.type !== \"literal\")\n      .map((p) => [p.type, parseInt(p.value, 10)])\n  ) as Record<string, number>;\n\n  const asUTC = Date.UTC(\n    lookup.year,\n    (lookup.month ?? 1) - 1,\n    lookup.day ?? 1,\n    lookup.hour ?? 0,\n    lookup.minute ?? 0,\n    lookup.second ?? 0\n  );\n\n  return (asUTC - date.getTime()) / 60000;\n}\n\nfunction parseICalDate(value: string, tzid: string | undefined, isDateOnly: boolean, warn: (msg: string) => void): Date | null {\n  const dateOnly = isDateOnly || !value.includes(\"T\");\n\n  const match = value.match(/^(\\d{4})(\\d{2})(\\d{2})(?:T(\\d{2})(\\d{2})(\\d{2})(Z)?)?$/);\n  if (!match) return null;\n  const [, y, mo, d, h = \"00\", mi = \"00\", s = \"00\", z] = match;\n\n  const year = Number(y);\n  const month = Number(mo) - 1;\n  const day = Number(d);\n  const hour = dateOnly ? 0 : Number(h);\n  const minute = dateOnly ? 0 : Number(mi);\n  const second = dateOnly ? 0 : Number(s);\n\n  if (z) {\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n\n  if (tzid) {\n    try {\n      const utcMillis = Date.UTC(year, month, day, hour, minute, second);\n      const offsetMinutes = getOffsetMinutes(new Date(utcMillis), tzid);\n      return new Date(utcMillis - offsetMinutes * 60_000);\n    } catch (err) {\n      warn(`Failed TZ conversion for ${tzid}: ${String(err)}`);\n    }\n  }\n\n  // Fallback: assume UTC when no timezone info.\n  return new Date(Date.UTC(year, month, day, hour, minute, second));\n}\n\nexport function parseDuration(value: string): number {\n  const match = value.match(/^P(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?)?$/);\n  if (!match) return NaN;\n  const [, d, h, m, s] = match;\n  const days = d ? Number(d) : 0;\n  const hours = h ? Number(h) : 0;\n  const minutes = m ? Number(m) : 0;\n  const seconds = s ? Number(s) : 0;\n  return (((days * 24 + hours) * 60 + minutes) * 60 + seconds) * 1000;\n}\n\nfunction parseFreeBusyPeriod(part: string, tzid: string | undefined, warn: (msg: string) => void): BusyBlock | null {\n  const [startRaw, endOrDurationRaw] = part.split(\"/\");\n  if (!startRaw || !endOrDurationRaw) return null;\n\n  const start = parseICalDate(startRaw, tzid, false, warn);\n  if (!start) return null;\n\n  const durationMs = parseDuration(endOrDurationRaw);\n  if (!Number.isNaN(durationMs)) {\n    return { start, end: new Date(start.getTime() + durationMs) };\n  }\n\n  const end = parseICalDate(endOrDurationRaw, tzid, false, warn);\n  if (!end) return null;\n  return { start, end };\n}\n\nfunction parseFreeBusyComponents(unfolded: string[], warn: (msg: string) => void): BusyBlock[] {\n  const busy: BusyBlock[] = [];\n  let inComponent = false;\n\n  for (const line of unfolded) {\n    const upper = line.toUpperCase();\n    if (upper === \"BEGIN:VFREEBUSY\") {\n      inComponent = true;\n      continue;\n    }\n    if (upper === \"END:VFREEBUSY\") {\n      inComponent = false;\n      continue;\n    }\n    if (!inComponent) continue;\n    if (!upper.startsWith(\"FREEBUSY\")) continue;\n\n    const [propPart, valuePart] = line.split(/:(.+)/, 2);\n    if (!valuePart) continue;\n\n    const params = propPart.split(\";\").slice(1);\n    const tzidParam = params.find((p) => p.toUpperCase().startsWith(\"TZID=\"));\n    const tzid = tzidParam ? tzidParam.split(\"=\")[1] : undefined;\n\n    const periods = valuePart.split(\",\");\n    for (const periodPart of periods) {\n      const parsed = parseFreeBusyPeriod(periodPart, tzid, warn);\n      if (parsed && parsed.end > parsed.start) {\n        busy.push(parsed);\n      }\n    }\n  }\n\n  return busy;\n}\n\nfunction parseEventComponents(unfolded: string[], warn: (msg: string) => void): BusyBlock[] {\n  const events: BusyBlock[] = [];\n  let inEvent = false;\n  let current: { start?: Date; end?: Date; startIsDateOnly?: boolean } = {};\n  let currentDuration: number | undefined;\n\n  for (const line of unfolded) {\n    const upper = line.toUpperCase();\n\n    if (upper === \"BEGIN:VEVENT\") {\n      inEvent = true;\n      current = {};\n      currentDuration = undefined;\n      continue;\n    }\n    if (upper === \"END:VEVENT\") {\n      if (inEvent && current.start) {\n        const isAllDay = Boolean(current.startIsDateOnly);\n        const durationMs = currentDuration;\n        const defaultEnd = isAllDay\n          ? new Date(current.start.getTime() + DAY_MS)\n          : new Date(current.start.getTime() + 60 * 60 * 1000);\n        const endValue = current.end\n          ? current.end\n          : typeof durationMs === \"number\" && !Number.isNaN(durationMs)\n            ? new Date(current.start.getTime() + durationMs)\n            : defaultEnd;\n\n        const end = isAllDay && endValue.getTime() === current.start.getTime()\n          ? new Date(current.start.getTime() + DAY_MS)\n          : endValue;\n\n        if (end > current.start) {\n          events.push({ start: current.start, end });\n        }\n      }\n      inEvent = false;\n      currentDuration = undefined;\n      continue;\n    }\n    if (!inEvent) continue;\n\n    if (upper.startsWith(\"DTSTART\")) {\n      const tzidMatch = line.match(/TZID=([^;:]+)/);\n      const isDateOnly = upper.includes(\"VALUE=DATE\") || !line.includes(\"T\");\n      const dateMatch = line.match(/[:;](\\d{8}(T\\d{6}Z?)?)/);\n      if (dateMatch) {\n        const parsed = parseICalDate(dateMatch[1], tzidMatch?.[1], isDateOnly, warn);\n        if (parsed) {\n          current.start = parsed;\n          current.startIsDateOnly = isDateOnly;\n        }\n      }\n    } else if (upper.startsWith(\"DTEND\")) {\n      const tzidMatch = line.match(/TZID=([^;:]+)/);\n      const isDateOnly = upper.includes(\"VALUE=DATE\") || !line.includes(\"T\");\n      const dateMatch = line.match(/[:;](\\d{8}(T\\d{6}Z?)?)/);\n      if (dateMatch) {\n        const parsed = parseICalDate(dateMatch[1], tzidMatch?.[1], isDateOnly, warn);\n        if (parsed) {\n          current.end = parsed;\n        }\n      }\n    } else if (upper.startsWith(\"DURATION\")) {\n      const dur = parseDuration(line.split(/:(.+)/, 2)[1] ?? \"\");\n      if (!Number.isNaN(dur)) {\n        currentDuration = dur;\n      }\n    }\n  }\n\n  return events;\n}\n\nexport function parseFreeBusy(icalText: string, warn: (msg: string) => void = () => {}): BusyBlock[] {\n  const unfolded = unfoldLines(icalText);\n  const busyFromFreeBusy = parseFreeBusyComponents(unfolded, warn);\n  const busyFromEvents = parseEventComponents(unfolded, warn);\n  return [...busyFromFreeBusy, ...busyFromEvents];\n}\n", "export interface BusyBlock {\n  start: Date;\n  end: Date;\n}\n\nconst MINUTE_MS = 60_000;\nconst WINDOW_DAYS = 28;\n\nexport function buildWindow(now: Date = new Date()): { windowStart: Date; windowEnd: Date } {\n  const roundedStart = new Date(Math.floor(now.getTime() / MINUTE_MS) * MINUTE_MS);\n  const windowEnd = new Date(roundedStart.getTime() + WINDOW_DAYS * 24 * 60 * MINUTE_MS);\n  return { windowStart: roundedStart, windowEnd };\n}\n\nexport function clipAndMerge(blocks: BusyBlock[], windowStart: Date, windowEnd: Date): BusyBlock[] {\n  const relevant = blocks\n    .map((block) => {\n      const start = block.start < windowStart ? windowStart : block.start;\n      const end = block.end > windowEnd ? windowEnd : block.end;\n      return { start, end };\n    })\n    .filter((block) => block.end > block.start && block.end > windowStart && block.start < windowEnd);\n\n  relevant.sort((a, b) => a.start.getTime() - b.start.getTime());\n  const merged: BusyBlock[] = [];\n\n  for (const block of relevant) {\n    const last = merged[merged.length - 1];\n    if (!last) {\n      merged.push(block);\n      continue;\n    }\n\n    const lastEnd = last.end.getTime();\n    const currentStart = block.start.getTime();\n    if (currentStart <= lastEnd) {\n      if (block.end.getTime() > lastEnd) {\n        last.end = block.end;\n      }\n    } else if (currentStart === lastEnd) {\n      last.end = block.end;\n    } else {\n      merged.push(block);\n    }\n  }\n\n  return merged;\n}\n\nexport function toResponseBlocks(blocks: BusyBlock[]): { start: string; end: string }[] {\n  return blocks.map((block) => ({ start: block.start.toISOString(), end: block.end.toISOString() }));\n}\n", "export interface Env {\n  FREEBUSY_ICAL_URL: string;\n  RL_SALT: string;\n  RATE_LIMITER: DurableObjectNamespace;\n}\n\nfunction isDurableObjectNamespace(value: unknown): value is DurableObjectNamespace {\n  return typeof value === \"object\" && value !== null && \"idFromName\" in (value as Record<string, unknown>);\n}\n\nexport function validateEnv(env: Partial<Env>): Env {\n  if (!env.FREEBUSY_ICAL_URL || typeof env.FREEBUSY_ICAL_URL !== \"string\") {\n    throw new Error(\"missing FREEBUSY_ICAL_URL\");\n  }\n  if (!env.RL_SALT || typeof env.RL_SALT !== \"string\") {\n    throw new Error(\"missing RL_SALT\");\n  }\n  if (!isDurableObjectNamespace(env.RATE_LIMITER)) {\n    throw new Error(\"missing RATE_LIMITER binding\");\n  }\n\n  // Basic URL validation without exposing the secret value.\n  try {\n    // eslint-disable-next-line no-new\n    new URL(env.FREEBUSY_ICAL_URL);\n  } catch {\n    throw new Error(\"invalid FREEBUSY_ICAL_URL\");\n  }\n\n  return env as Env;\n}\n", "import { Env } from \"./env\";\n\nconst WINDOW_MS = 5 * 60 * 1000;\nconst LIMIT = 60;\nconst DO_NAME = \"rate-limiter\";\n\nexport interface RateLimitOutcome {\n  allowed: boolean;\n  remaining: number;\n  reset: number;\n}\n\nexport async function hashIp(ip: string, salt: string): Promise<string> {\n  const data = new TextEncoder().encode(`${ip}${salt}`);\n  const digest = await crypto.subtle.digest(\"SHA-256\", data);\n  const bytes = new Uint8Array(digest);\n  return Array.from(bytes)\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n}\n\nexport async function enforceRateLimit(env: Env, ip: string): Promise<RateLimitOutcome> {\n  const key = await hashIp(ip, env.RL_SALT);\n  const id = env.RATE_LIMITER.idFromName(DO_NAME);\n  const stub = env.RATE_LIMITER.get(id);\n  const res = await stub.fetch(\"https://rate-limit/\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ key }),\n  });\n\n  if (!res.ok) {\n    throw new Error(\"rate_limit_error\");\n  }\n\n  const data = (await res.json()) as Partial<RateLimitOutcome>;\n  return {\n    allowed: Boolean(data.allowed),\n    remaining: Number.isFinite(data.remaining) ? (data.remaining as number) : 0,\n    reset: Number.isFinite(data.reset) ? (data.reset as number) : Date.now() + WINDOW_MS,\n  };\n}\n\ninterface StoredCounter {\n  count: number;\n  windowStart: number;\n}\n\nexport class RateLimitDurable {\n  private storage: DurableObjectStorage;\n\n  constructor(state: DurableObjectState) {\n    this.storage = state.storage;\n  }\n\n  async fetch(request: Request): Promise<Response> {\n    if (request.method !== \"POST\") {\n      return new Response(\"method not allowed\", { status: 405 });\n    }\n\n    let body: { key?: string };\n    try {\n      body = (await request.json()) as { key?: string };\n    } catch {\n      return Response.json({ error: \"bad_request\" }, { status: 400 });\n    }\n\n    if (!body.key || typeof body.key !== \"string\") {\n      return Response.json({ error: \"bad_request\" }, { status: 400 });\n    }\n\n    const now = Date.now();\n    const current = (await this.storage.get<StoredCounter>(body.key)) ?? { count: 0, windowStart: now };\n\n    let { count, windowStart } = current;\n    if (now - windowStart >= WINDOW_MS) {\n      count = 0;\n      windowStart = now;\n    }\n\n    count += 1;\n    const allowed = count <= LIMIT;\n    const remaining = allowed ? LIMIT - count : 0;\n\n    await this.storage.put(body.key, { count, windowStart });\n\n    return Response.json({ allowed, remaining, reset: windowStart + WINDOW_MS });\n  }\n}\n", "import { parseFreeBusy } from \"./ical\";\nimport { buildWindow, clipAndMerge, toResponseBlocks } from \"./freebusy\";\nimport { Env, validateEnv } from \"./env\";\nimport { enforceRateLimit } from \"./rateLimit\";\n\ninterface CachedData {\n  fetchedAt: number;\n  busy: ReturnType<typeof parseFreeBusy>;\n}\n\nconst CACHE_TTL_MS = 60_000;\nconst ALLOWED_ORIGINS = new Set([\n  \"https://freebusy.robertsinfosec.com\",\n  \"http://localhost:5000\",\n]);\n\nlet cached: CachedData | null = null;\n\nfunction baseHeaders(): Headers {\n  const headers = new Headers();\n  headers.set(\"Cache-Control\", \"no-store\");\n  headers.set(\"X-Robots-Tag\", \"noindex\");\n  headers.set(\"Content-Security-Policy\", \"default-src 'none'\");\n  headers.set(\"X-Content-Type-Options\", \"nosniff\");\n  headers.set(\"Vary\", \"Origin\");\n  return headers;\n}\n\nfunction applyCors(headers: Headers, origin: string | null): boolean {\n  if (!origin) return true;\n  if (!ALLOWED_ORIGINS.has(origin)) return false;\n  headers.set(\"Access-Control-Allow-Origin\", origin);\n  headers.set(\"Access-Control-Allow-Methods\", \"GET,OPTIONS\");\n  headers.set(\"Access-Control-Allow-Headers\", \"Content-Type\");\n  headers.set(\"Access-Control-Max-Age\", \"600\");\n  return true;\n}\n\nfunction jsonResponse(request: Request, body: unknown, status = 200): Response {\n  const origin = request.headers.get(\"Origin\");\n  const headers = baseHeaders();\n  headers.set(\"Content-Type\", \"application/json\");\n  const allowed = applyCors(headers, origin);\n  if (origin && !allowed) {\n    return new Response(JSON.stringify({ error: \"forbidden_origin\" }), { status: 403, headers });\n  }\n  return new Response(JSON.stringify(body), { status, headers });\n}\n\nfunction redactUrl(secretUrl: string): string {\n  try {\n    const url = new URL(secretUrl);\n    const parts = url.pathname.split(\"/\").filter(Boolean);\n    if (parts.length > 0) {\n      parts[parts.length - 1] = \"***\";\n    }\n    const redactedPath = parts.length ? `/${parts.join(\"/\")}` : \"/\";\n    return `${url.origin}${redactedPath}`;\n  } catch {\n    return \"<invalid-url>\";\n  }\n}\n\nasync function fetchUpstream(env: Env): Promise<ReturnType<typeof parseFreeBusy>> {\n  const now = Date.now();\n  if (cached && now - cached.fetchedAt < CACHE_TTL_MS) {\n    return cached.busy;\n  }\n\n  const target = redactUrl(env.FREEBUSY_ICAL_URL);\n  console.info(\"[freebusy] fetching upstream iCal\", { target });\n\n  const res = await fetch(env.FREEBUSY_ICAL_URL, {\n    headers: {\n      Accept: \"text/calendar,text/plain\",\n    },\n  });\n\n  console.info(\"[freebusy] upstream response\", { target, status: res.status, ok: res.ok });\n  if (!res.ok) {\n    throw new Error(\"upstream_fetch_failed\");\n  }\n\n  const contentType = res.headers.get(\"content-type\") ?? \"\";\n  if (contentType && !contentType.includes(\"text/calendar\") && !contentType.includes(\"text/plain\")) {\n    throw new Error(\"unexpected_content_type\");\n  }\n\n  const text = await res.text();\n  const diagnostics = {\n    bytes: text.length,\n    hasVfreebusy: /BEGIN:VFREEBUSY/i.test(text),\n    freebusyTokens: (text.match(/FREEBUSY/gi) || []).length,\n  };\n  console.info(\"[freebusy] upstream ical diagnostics\", { target, ...diagnostics });\n\n  const busy = parseFreeBusy(text, (msg) => console.warn(\"[freebusy] parse warning\", msg));\n  console.info(\"[freebusy] parsed busy blocks\", { count: busy.length });\n  cached = { fetchedAt: now, busy };\n  return busy;\n}\n\nasync function handleFreeBusy(request: Request, env: Env): Promise<Response> {\n  const ip = request.headers.get(\"CF-Connecting-IP\") ?? \"0.0.0.0\";\n\n  try {\n    const result = await enforceRateLimit(env, ip);\n    if (!result.allowed) {\n      return jsonResponse(request, { error: \"rate_limited\" }, 429);\n    }\n  } catch (err) {\n    console.error(\"rate limit failure\", err);\n    return jsonResponse(request, { error: \"upstream\" }, 502);\n  }\n\n  let busy;\n  try {\n    busy = await fetchUpstream(env);\n  } catch (err) {\n    console.error(\"upstream fetch error\", err);\n    return jsonResponse(request, { error: \"upstream\" }, 502);\n  }\n\n  const now = new Date();\n  const { windowStart, windowEnd } = buildWindow(now);\n\n  let merged;\n  try {\n    merged = clipAndMerge(busy, windowStart, windowEnd);\n  } catch (err) {\n    console.error(\"parse/merge error\", err);\n    return jsonResponse(request, { error: \"parse\" }, 502);\n  }\n\n  const responseBody = {\n    generatedAt: now.toISOString(),\n    window: { start: windowStart.toISOString(), end: windowEnd.toISOString() },\n    timezone: \"Etc/UTC\",\n    busy: toResponseBlocks(merged),\n  };\n\n  return jsonResponse(request, responseBody, 200);\n}\n\nfunction handleHealth(request: Request): Response {\n  return jsonResponse(request, { ok: true }, 200);\n}\n\nasync function handleOptions(request: Request): Promise<Response> {\n  const origin = request.headers.get(\"Origin\");\n  const headers = baseHeaders();\n  const allowed = applyCors(headers, origin);\n  if (!allowed) {\n    return new Response(null, { status: 403, headers });\n  }\n  headers.set(\"Content-Length\", \"0\");\n  return new Response(null, { status: 204, headers });\n}\n\nexport default {\n  async fetch(request: Request, env: Env): Promise<Response> {\n    let validatedEnv: Env;\n    try {\n      validatedEnv = validateEnv(env);\n    } catch (err) {\n      console.error(\"env validation failed\", err);\n      return jsonResponse(request, { error: \"misconfigured\" }, 500);\n    }\n\n    const { pathname } = new URL(request.url);\n    if (request.method === \"OPTIONS\") {\n      return handleOptions(request);\n    }\n\n    if (pathname === \"/health\") {\n      return handleHealth(request);\n    }\n\n    if (pathname === \"/freebusy\" && request.method === \"GET\") {\n      return handleFreeBusy(request, validatedEnv);\n    }\n\n    return jsonResponse(request, { error: \"not_found\" }, 404);\n  },\n};\n\nexport { RateLimitDurable } from \"./rateLimit\";\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/src/index.ts\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/.wrangler/tmp/bundle-VGrhv0/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/.wrangler/tmp/bundle-VGrhv0/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/robert/gitlocal/robertsinfosec/freebusy-api/src/.wrangler/tmp/bundle-VGrhv0/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
